---
# Main playbook for AIDEAS API infrastructure management
# This replaces the buggy Terraform approach with reliable Ansible

- name: "ğŸš€ AIDEAS API Infrastructure Management"
  hosts: localhost
  gather_facts: false
  vars:
    instance_name: "aideas-api-production"
    security_group_name: "aideas-api-sg"
    eip_tag_name: "aideas-api-production-eip"
    dns_record_name: "api.musicalaideas.com"

  tasks:
    - name: "ğŸ“‹ Include EC2 instance management"
      include_tasks: tasks/ec2.yml

    - name: "ğŸ”’ Include security group management"
      include_tasks: tasks/security-groups.yml

    - name: "ğŸŒ Include EIP management"
      include_tasks: tasks/eip.yml

    - name: "ğŸŒ Include Cloudflare DNS management"
      include_tasks: tasks/cloudflare.yml
      when: cloudflare_zone_id is defined and cloudflare_api_token is defined

    - name: "ğŸ“¦ Include application deployment"
      include_tasks: tasks/deploy.yml
      when: deploy_app | default(false)
