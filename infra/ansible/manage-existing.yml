---
# Ansible playbook for managing existing AIDEAS API infrastructure
# This complements Terraform by handling ongoing management tasks

- name: "ğŸ”§ AIDEAS API Resource Management"
  hosts: localhost
  gather_facts: false
  vars:
    instance_name: "aideas-api-production"
    security_group_name: "aideas-api-sg"
    eip_tag_name: "aideas-api-production-eip"

  tasks:
    - name: "ğŸ” Check if EC2 instance exists"
      ec2_instance_info:
        filters:
          "tag:Name": "{{ instance_name }}"
          "instance-state-name": "running"
      register: existing_instance

    - name: "ğŸ” Check if security group exists"
      ec2_group_info:
        filters:
          "group-name": "{{ security_group_name }}"
      register: existing_sg

    - name: "ğŸ” Check if EIP exists"
      ec2_eip_info:
        filters:
          "tag:Name": "{{ eip_tag_name }}"
      register: existing_eip

    - name: "ğŸ“Š Display current infrastructure status"
      debug:
        msg: |
          EC2 Instance: {{ existing_instance.instances[0].instance_id if existing_instance.instances else 'Not found' }}
          Security Group: {{ existing_sg.security_groups[0].group_id if existing_sg.security_groups else 'Not found' }}
          EIP: {{ existing_eip.addresses[0].allocation_id if existing_eip.addresses else 'Not found' }}

    - name: "âœ… Infrastructure check complete"
      debug:
        msg: "All infrastructure resources verified. Use deploy-ansible workflow for application deployment."
